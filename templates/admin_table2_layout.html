{% extends "base.html" %}
{% load report_extras %}

{% block title %}Макет — {{ date|date:"d.m.Y" }}{% endblock %}

{% block content %}
<style>
  /* =========================
     Scope: ONLY this page
     ========================= */
  .t2layout{
    --r14:14px;
    --r18:18px;
    --r20:20px;
    --line: var(--stroke, rgba(15,23,42,.12));
    --soft: rgba(255,255,255,.55);
  }

  .t2layout .panel{
    background: var(--surface, rgba(255,255,255,.78));
    border: 1px solid var(--line);
    border-radius: 20px;
    box-shadow: var(--shadow, 0 18px 60px rgba(15,23,42,.12));
    padding: 14px;
    backdrop-filter: blur(14px);
  }

  .t2layout .hdr{
    display:flex;align-items:flex-start;justify-content:space-between;
    gap:12px;flex-wrap:wrap;
  }
  .t2layout .hdr h2{
    margin:0;
    font-size:18px;
    font-weight:800; /* ✅ juda qalin emas */
    letter-spacing:-.01em;
    color:var(--text, #0f172a);
  }
  .t2layout .sub{
    margin-top:6px;
    color:var(--muted,#64748b);
    font-size:13px;
    line-height:1.45;
  }

  .t2layout .btnBack{
    display:inline-flex;align-items:center;gap:8px;
    padding:10px 14px;border-radius:999px;
    border:1px solid var(--line);
    background: var(--soft);
    color:var(--text,#0f172a);
    text-decoration:none;
    font-weight:750;
    white-space:nowrap;
    transition:transform .12s ease, box-shadow .12s ease, filter .12s ease;
  }
  html[data-theme="dark"] .t2layout .btnBack{ background:rgba(255,255,255,.06); }
  .t2layout .btnBack:hover{
    transform:translateY(-1px);
    box-shadow:0 16px 44px rgba(15,23,42,.10);
    filter:brightness(1.02);
  }

  /* =========================
     Table container
     ========================= */
  .t2layout .xwrap{
    margin-top:12px;
    border:1px solid var(--line);
    border-radius:18px;
    overflow:auto;
    background:rgba(255,255,255,.18);
    position:relative;
  }
  html[data-theme="dark"] .t2layout .xwrap{ background:rgba(255,255,255,.04); }

  /* scroll shadows (nice) */
  .t2layout .xwrap:before,
  .t2layout .xwrap:after{
    content:"";
    position:sticky;
    top:0;
    width:18px;
    height:100%;
    pointer-events:none;
    z-index:30;
    display:block;
  }
  .t2layout .xwrap:before{
    left:0;
    background:linear-gradient(90deg, rgba(0,0,0,.10), transparent);
    opacity:.15;
  }
  .t2layout .xwrap:after{
    right:0;
    background:linear-gradient(270deg, rgba(0,0,0,.10), transparent);
    opacity:.12;
  }
  html[data-theme="dark"] .t2layout .xwrap:before,
  html[data-theme="dark"] .t2layout .xwrap:after{
    opacity:.22;
  }

  .t2layout .xhead{
    padding:12px 14px;
    border-bottom:1px solid var(--line);
    background:rgba(255,255,255,.32);
    color:var(--text,#0f172a);
  }
  html[data-theme="dark"] .t2layout .xhead{ background:rgba(255,255,255,.06); }

  .t2layout .xhead .title{ font-weight:800; }
  .t2layout .xhead .date{ color:var(--muted,#64748b); font-size:12.5px; margin-top:4px; }

  /* =========================
     Table (scoped)
     ========================= */
  .t2layout table.t2tbl{
    border-collapse:separate;
    border-spacing:0;
    width:max-content;
    min-width:980px;
    table-layout:fixed;
  }

  .t2layout .t2tbl th,
  .t2layout .t2tbl td{
    border-right:1px solid rgba(15,23,42,.10);
    border-bottom:1px solid rgba(15,23,42,.10);
    padding:8px 8px;
    font-size:12px;
    line-height:1.2;
    text-align:center;
    vertical-align:middle;
    color:var(--text,#0f172a);
    background:transparent;
    white-space:nowrap;
  }
  html[data-theme="dark"] .t2layout .t2tbl th,
  html[data-theme="dark"] .t2layout .t2tbl td{
    border-right:1px solid rgba(255,255,255,.12);
    border-bottom:1px solid rgba(255,255,255,.12);
  }

  .t2layout .t2tbl thead th{
    position:sticky; top:0; z-index:20;
    background: var(--surface, rgba(255,255,255,.78));
    font-weight:800;
  }



  /* col widths */
  .t2layout .colMetric{ width:280px; text-align:left; font-weight:800; }
  .t2layout .colSub{ width:90px; text-align:left; font-weight:800; color:var(--muted,#64748b); }

  /* zebra + hover */
  .t2layout .t2tbl tbody tr:nth-child(even) td{ background: rgba(255,255,255,.12); }
  html[data-theme="dark"] .t2layout .t2tbl tbody tr:nth-child(even) td{ background: rgba(255,255,255,.04); }

  .t2layout .t2tbl tbody tr:hover td{ background: rgba(79,70,229,.06); }
  html[data-theme="dark"] .t2layout .t2tbl tbody tr:hover td{ background: rgba(99,102,241,.10); }

  /* group rows */
  .t2layout .group td{
    background:rgba(15,23,42,.03);
    font-weight:800;
  }
  html[data-theme="dark"] .t2layout .group td{ background:rgba(255,255,255,.06); }

  /* small screen */
  @media (max-width: 640px){
    .t2layout .hdr h2{ font-size:16px; }
    .t2layout .t2tbl th, .t2layout .t2tbl td{ font-size:11.5px; padding:7px 7px; }
    .t2layout .colMetric{ width:240px; }
    .t2layout .stickyB{ left:240px; }
  }
</style>

<div class="t2layout">
  <div class="panel">
    <div class="hdr">
      <div>
        <h2>
          <span data-i18n="t2_layout_title">Макет</span> — {{ date|date:"d.m.Y" }}
        </h2>
        <div class="sub">
          <span data-i18n="t2_layout_sub">Работа с контейнерами (по оперативным данным)</span>
        </div>
      </div>

      <a class="btnBack" href="{% url 'admin_table2_reports' %}">
        <span aria-hidden="true">←</span> <span data-i18n="back">Назад</span>
      </a>
    </div>

    <div class="xwrap">
      <div class="xhead">
        <div class="title" data-i18n="t2_layout_header">Работа с контейнерами (по оперативным данным)</div>
        <div class="date">
          <span data-i18n="date">Дата</span>: {{ date|date:"d.m.Y" }}
        </div>
      </div>

      <table class="t2tbl">
        <colgroup>
          <col class="colMetric">
          <col class="colSub">
          {% for c in cols %}
            <col style="width:120px">
          {% endfor %}
        </colgroup>

        <thead>
          <tr>
            <th class="colMetric stickyA" data-i18n="col_metrics">Показатели</th>
            <th class="colSub stickyB"></th>
            {% for c in cols %}
              <th>{{ c.title }}</th>
            {% endfor %}
          </tr>
        </thead>

        <tbody>
          <tr class="group">
            <td rowspan="2" class="colMetric stickyA" data-i18n="row_workpark">Рабочий парк</td>
            <td class="colSub stickyB" data-i18n="sub_cont">Конт</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"work_cont" }}</b></td>{% endfor %}
          </tr>
          <tr>
            <td class="colSub stickyB" data-i18n="sub_kr">КР</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"work_kr" }}</b></td>{% endfor %}
          </tr>

          <tr class="group">
            <td rowspan="2" class="colMetric stickyA" data-i18n="row_load">Погрузка контейнеров</td>
            <td class="colSub stickyB" data-i18n="sub_cont">Конт</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"pogr_cont" }}</b></td>{% endfor %}
          </tr>
          <tr>
            <td class="colSub stickyB" data-i18n="sub_kr">КР</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"pogr_kr" }}</b></td>{% endfor %}
          </tr>

          <tr class="group">
            <td rowspan="2" class="colMetric stickyA" data-i18n="row_unload">Выгрузка контейнеров</td>
            <td class="colSub stickyB" data-i18n="sub_cont">Конт</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"vygr_cont" }}</b></td>{% endfor %}
          </tr>
          <tr>
            <td class="colSub stickyB" data-i18n="sub_kr">КР</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"vygr_kr" }}</b></td>{% endfor %}
          </tr>

          <tr class="group">
            <td class="colMetric stickyA" data-i18n="row_tuk">Выгрузка ТУК</td>
            <td class="colSub stickyB"></td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"vygr_tuk" }}</b></td>{% endfor %}
          </tr>

          <tr class="group">
            <td rowspan="2" class="colMetric stickyA" data-i18n="row_site">Парк на площадке</td>
            <td class="colSub stickyB" data-i18n="sub_cont">Конт</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"site_cont" }}</b></td>{% endfor %}
          </tr>
          <tr>
            <td class="colSub stickyB" data-i18n="sub_kr">КР</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"site_kr" }}</b></td>{% endfor %}
          </tr>

          <tr class="group">
            <td rowspan="2" class="colMetric stickyA" data-i18n="row_to_export">К вывозу</td>
            <td class="colSub stickyB" data-i18n="sub_cont">Конт</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"to_export_cont" }}</b></td>{% endfor %}
          </tr>
          <tr>
            <td class="colSub stickyB" data-i18n="sub_kr">КР</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"to_export_kr" }}</b></td>{% endfor %}
          </tr>

          <tr class="group">
            <td rowspan="2" class="colMetric stickyA" data-i18n="row_ready">Готовые к отправлению</td>
            <td class="colSub stickyB" data-i18n="sub_cont">Конт</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"ready_cont" }}</b></td>{% endfor %}
          </tr>
          <tr>
            <td class="colSub stickyB" data-i18n="sub_kr">КР</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"ready_kr" }}</b></td>{% endfor %}
          </tr>

          <tr class="group">
            <td rowspan="2" class="colMetric stickyA" data-i18n="row_empty">Порожние</td>
            <td class="colSub stickyB" data-i18n="sub_cont">Конт</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"empty_cont" }}</b></td>{% endfor %}
          </tr>
          <tr>
            <td class="colSub stickyB" data-i18n="sub_kr">КР</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"empty_kr" }}</b></td>{% endfor %}
          </tr>

          <tr class="group">
            <td rowspan="2" class="colMetric stickyA" data-i18n="row_sort">Под сортировку</td>
            <td class="colSub stickyB" data-i18n="sub_cont">Конт</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"sort_cont" }}</b></td>{% endfor %}
          </tr>
          <tr>
            <td class="colSub stickyB" data-i18n="sub_kr">КР</td>
            {% for c in cols %}<td><b>{{ buckets|get_item:c.key|get_item:"sort_kr" }}</b></td>{% endfor %}
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
/* =========================
   Page i18n (base’ga tegmasdan)
   - base.js localStorage('lang') ni almashtirsa ham shu page yangilanadi
   ========================= */
(function(){
  const dict = {
    uz: {
      t2_layout_title: "Makет",
      t2_layout_sub: "Konteynerlar bo‘yicha ishlar (operativ ma’lumotlar)",
      t2_layout_header: "Konteynerlar bo‘yicha ishlar (operativ ma’lumotlar)",
      back: "Orqaga",
      date: "Sana",
      col_metrics: "Ko‘rsatkichlar",

      row_workpark: "Ishchi park",
      row_load: "Konteynerlarni yuklash",
      row_unload: "Konteynerlarni tushirish",
      row_tuk: "TUK tushirish",
      row_site: "Maydondagi park",
      row_to_export: "Olib chiqishga",
      row_ready: "Jo‘natishga tayyor",
      row_empty: "Bo‘sh",
      row_sort: "Saralashga",

      sub_cont: "Kont",
      sub_kr: "KR",
    },
    ru: {
      t2_layout_title: "Макет",
      t2_layout_sub: "Работа с контейнерами (по оперативным данным)",
      t2_layout_header: "Работа с контейнерами (по оперативным данным)",
      back: "Назад",
      date: "Дата",
      col_metrics: "Показатели",

      row_workpark: "Рабочий парк",
      row_load: "Погрузка контейнеров",
      row_unload: "Выгрузка контейнеров",
      row_tuk: "Выгрузка ТУК",
      row_site: "Парк на площадке",
      row_to_export: "К вывозу",
      row_ready: "Готовые к отправлению",
      row_empty: "Порожние",
      row_sort: "Под сортировку",

      sub_cont: "Конт",
      sub_kr: "КР",
    }
  };

  function getLang(){
    const saved = localStorage.getItem('lang') || 'uz';
    return saved === 'ru' ? 'ru' : 'uz';
  }

  function applyLang(lang){
    const t = dict[lang] || dict.uz;
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const k = el.getAttribute('data-i18n');
      if(t[k] != null) el.textContent = t[k];
    });
  }

  let last = getLang();
  applyLang(last);

  // base langBtn bosilganda localStorage o‘zgaradi — shu page ham yangilanadi
  setInterval(()=>{
    const cur = getLang();
    if(cur !== last){
      last = cur;
      applyLang(cur);
    }
  }, 250);
})();
</script>
{% endblock %}
