{% extends "base.html" %}
{% load report_extras %}

{% block title %}
–¢–∞–±–ª–∏—Ü–∞ 2 ‚Äî {% if mode == 'view' %}–ü—Ä–æ—Å–º–æ—Ç—Ä{% else %}–°–æ–∑–¥–∞–Ω–∏–µ/–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ{% endif %}
{% endblock %}

{% block content %}
<style>
  /* =========================
     PAGE LAYOUT (center + responsive)
  ========================= */
  .page2{
    width:100%;
    max-width:1180px;
    margin:0 auto;
    padding:0 12px;
    box-sizing:border-box;
  }

  /* =========================
     BUTTONS (Save / Back) + dark mode
  ========================= */
  .actions{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
    justify-content:flex-start;
    margin:0 0 12px;
  }

  .btnx{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    height:42px;
    padding:0 14px;
    border-radius:14px;
    border:1px solid rgba(15,23,42,.14);
    font-weight:950;
    text-decoration:none;
    cursor:pointer;
    user-select:none;
    transition:transform .12s ease, filter .12s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
    box-shadow:0 10px 22px rgba(15,23,42,.10);
    white-space:nowrap;
  }
  .btnx:active{ transform:translateY(0); }
  .btnx:hover{ transform:translateY(-1px); filter:saturate(1.05); }

  .btnx.primary{
    color:#fff;
    background:linear-gradient(135deg, rgba(37,99,235,.96), rgba(16,185,129,.92));
    border-color:rgba(37,99,235,.40);
  }
  .btnx.secondary{
    color:#0f172a;
    background:rgba(255,255,255,.78);
    border-color:rgba(15,23,42,.14);
  }

  /* dark theme (base.html html[data-theme="dark"]) */
  html[data-theme="dark"] .btnx{
    box-shadow:0 10px 22px rgba(0,0,0,.35);
    border-color:rgba(255,255,255,.14);
  }
  html[data-theme="dark"] .btnx.secondary{
    color:rgba(255,255,255,.92);
    background:rgba(255,255,255,.08);
  }
  html[data-theme="dark"] .btnx.primary{
    border-color:rgba(99,102,241,.45);
  }

  /* mobile: buttons full width */
  @media (max-width: 720px){
    .actions{ gap:8px; }
    .btnx{ width:100%; }
  }

  /* =========================
     TABLE WRAP (no empty right space)
  ========================= */
  .wrap2{
    width:100%;
    background:rgba(255,255,255,.92);
    border:1px solid rgba(15,23,42,.18);
    border-radius:16px;
    overflow:auto;
    padding:10px;
    box-sizing:border-box;
    box-shadow:0 14px 34px rgba(15,23,42,.08);
  }
  html[data-theme="dark"] .wrap2{
    background:rgba(255,255,255,.06);
    border-color:rgba(255,255,255,.14);
    box-shadow:0 18px 46px rgba(0,0,0,.35);
  }

  /* scroll bar nicer */
  .wrap2::-webkit-scrollbar{ height:10px; width:10px; }
  .wrap2::-webkit-scrollbar-thumb{ background:rgba(15,23,42,.22); border-radius:999px; }
  html[data-theme="dark"] .wrap2::-webkit-scrollbar-thumb{ background:rgba(255,255,255,.18); }

  /* =========================
     TABLE (structure preserved)
  ========================= */
  .t2{
    border-collapse:separate;
    border-spacing:0;
    width:100%;
    min-width:980px; /* STRUCTURE NOT BROKEN */
    table-layout:fixed;
  }

  /* stronger borders (better visible lines) */
  .t2 th,.t2 td{
    border-right:1px solid rgba(15,23,42,.22);
    border-bottom:1px solid rgba(15,23,42,.22);
    padding:6px 8px;
    font-size:12px;
    vertical-align:middle;
    background:transparent;
  }
  .t2 tr > *:first-child{ border-left:1px solid rgba(15,23,42,.22); }
  .t2 thead tr:first-child > *{ border-top:1px solid rgba(15,23,42,.22); }

  html[data-theme="dark"] .t2 th,
  html[data-theme="dark"] .t2 td{
    border-right:1px solid rgba(255,255,255,.18);
    border-bottom:1px solid rgba(255,255,255,.18);
  }
  html[data-theme="dark"] .t2 tr > *:first-child{ border-left:1px solid rgba(255,255,255,.18); }
  html[data-theme="dark"] .t2 thead tr:first-child > *{ border-top:1px solid rgba(255,255,255,.18); }

  .center{text-align:center}
  .bold{font-weight:900}

  .headDate{
    text-align:center;
    font-weight:950;
    font-size:13px;
    padding:10px 8px;
    background:linear-gradient(180deg, rgba(248,250,252,.95), rgba(241,245,249,.80));
  }
  html[data-theme="dark"] .headDate{
    background:rgba(255,255,255,.06);
  }

  .secTitle{
    font-weight:950;
    text-align:center;
    padding:8px 8px;
    background:rgba(248,250,252,.88);
  }
  html[data-theme="dark"] .secTitle{
    background:rgba(255,255,255,.06);
  }

  .danger{color:#b91c1c;font-weight:950}
  html[data-theme="dark"] .danger{ color:#fb7185; }

  .muted{color:#64748b}
  html[data-theme="dark"] .muted{ color:rgba(226,232,240,.72); }

  .t2 input{
    width:100%;
    height:32px;
    padding:4px 8px;
    border:1px solid rgba(148,163,184,.95);
    border-radius:10px;
    text-align:center;
    font-weight:900;
    box-sizing:border-box;
    background:rgba(255,255,255,.92);
    color:#0f172a;
    outline:none;
    transition:border-color .12s ease, box-shadow .12s ease, background .12s ease;
  }
  .t2 input:focus{
    border-color:rgba(37,99,235,.70);
    box-shadow:0 0 0 4px rgba(37,99,235,.14);
    background:#fff;
  }
  .t2 input[disabled]{background:rgba(241,245,249,.9);color:#111}

  html[data-theme="dark"] .t2 input{
    background:rgba(255,255,255,.08);
    border-color:rgba(255,255,255,.18);
    color:rgba(255,255,255,.92);
  }
  html[data-theme="dark"] .t2 input:focus{
    border-color:rgba(99,102,241,.70);
    box-shadow:0 0 0 4px rgba(99,102,241,.18);
    background:rgba(255,255,255,.10);
  }
  html[data-theme="dark"] .t2 input[disabled]{
    background:rgba(255,255,255,.06);
    color:rgba(255,255,255,.72);
  }
</style>

<div class="page2">
  <div class="card">
    <h2 style="margin:0 0 10px;">
      –¢–∞–±–ª–∏—Ü–∞ ‚Ññ2 ‚Äî {% if mode == 'view' %}–ü—Ä–æ—Å–º–æ—Ç—Ä{% else %}–°–æ–∑–¥–∞–Ω–∏–µ/–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ{% endif %}
    </h2>

    <div class="actions">
      <a href="{% url 'station_table_2_list' %}" class="btnx secondary">‚Üê –ù–∞–∑–∞–¥</a>
      {% if mode != 'view' %}
        <button type="submit" form="t2form" class="btnx primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      {% endif %}
      
    </div>

    <form id="t2form" method="post">
      {% csrf_token %}

      <div class="wrap2">

        <!-- ================= –û–°–ù–û–í–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê (6 –∫–æ–ª–æ–Ω–æ–∫) ================= -->
        <table class="t2">
          <colgroup>
            <col style="width:60px;">
            <col>
            <col style="width:140px;">
            <col style="width:80px;">
            <col style="width:110px;">
            <col style="width:110px;">
          </colgroup>

          <thead>
            <tr>
              <th colspan="6" class="headDate">{{ date|date:"d.m.Y" }}</th>
            </tr>
            <tr>
              <th class="center bold" rowspan="2">‚Ññ –ø/–ø</th>
              <th class="center bold" colspan="2" rowspan="2">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è</th>
              <th class="center bold">–ö–æ–¥</th>
              <th class="center bold">
                {{ station_name }}
                <div style="font-size:11px;font-weight:950;margin-top:2px;">–≤—Å–µ–≥–æ</div>
              </th>
              <th class="center bold">
                {{ station_name }}
                <div style="font-size:11px;font-weight:950;margin-top:2px;">–∫—Ç–∫</div>
              </th>
            </tr>
            <tr>
              <th class="center bold" style="font-size:11px;">–ø–æ–∫-–ª—è</th>
              <th class="center bold" style="font-size:11px;">72000</th>
              <th class="center bold" style="font-size:11px;"></th>
            </tr>
          </thead>

          <tbody>
            {% for n,label,code,k_total,k_ktk in rows_def %}

              {% if n == 8 %}
                <tr>
                  <td class="center bold" rowspan="2">8</td>
                  <td colspan="2">{{ label }}</td>
                  <td class="center">{{ code }}</td>
                  <td class="center">
                    <input name="{{ k_total }}" value="{{ obj|data_val:k_total }}" {% if mode == 'view' %}disabled{% endif %}>
                  </td>
                  <td class="center">
                    <input name="{{ k_ktk }}" value="{{ obj|data_val:k_ktk }}" {% if mode == 'view' %}disabled{% endif %}>
                  </td>
                </tr>

                {% for n2,label2,code2,k_total2,k_ktk2 in rows_def %}
                  {% if n2 == 9 %}
                    <tr>
                      <td colspan="2">{{ label2 }}</td>
                      <td class="center">{{ code2 }}</td>
                      <td class="center">
                        <input name="{{ k_total2 }}" value="{{ obj|data_val:k_total2 }}" {% if mode == 'view' %}disabled{% endif %}>
                      </td>
                      <td class="center">
                        <input name="{{ k_ktk2 }}" value="{{ obj|data_val:k_ktk2 }}" {% if mode == 'view' %}disabled{% endif %}>
                      </td>
                    </tr>
                  {% endif %}
                {% endfor %}

              {% elif n == 9 %}
                {# skip #}

              {% elif n == 22 %}
                <tr>
                  <td class="center bold" rowspan="2">21</td>
                  <td class="bold" rowspan="2">–ó–∞–≥—Ä—É–∂–µ–Ω–æ</td>
                  <td class="bold">–ì—Ä—É–∂—ë–Ω—ã–µ</td>
                  <td class="center">–ó/–≥</td>
                  <td class="center">
                    <input name="{{ k_total }}" value="{{ obj|data_val:k_total }}" {% if mode == 'view' %}disabled{% endif %}>
                  </td>
                  <td class="center">
                    <input name="{{ k_ktk }}" value="{{ obj|data_val:k_ktk }}" {% if mode == 'view' %}disabled{% endif %}>
                  </td>
                </tr>

                <tr>
                  <td class="bold">–ü–æ—Ä–æ–∂–Ω–∏–µ</td>
                  <td class="center">–ó/–ø</td>
                  <td class="center">
                    <input name="r22p_total" value="{{ obj|data_val:'r22p_total' }}" {% if mode == 'view' %}disabled{% endif %}>
                  </td>
                  <td class="center">
                    <input name="r22p_ktk" value="{{ obj|data_val:'r22p_ktk' }}" {% if mode == 'view' %}disabled{% endif %}>
                  </td>
                </tr>

              {% else %}
                <tr>
                  <td class="center bold">
                    {% if n >= 10 %}{{ n|add:"-1" }}{% else %}{{ n }}{% endif %}
                  </td>
                  <td colspan="2">{{ label }}</td>
                  <td class="center">{{ code }}</td>
                  <td class="center">
                    <input name="{{ k_total }}" value="{{ obj|data_val:k_total }}" {% if mode == 'view' %}disabled{% endif %}>
                  </td>
                  <td class="center">
                    <input name="{{ k_ktk }}" value="{{ obj|data_val:k_ktk }}" {% if mode == 'view' %}disabled{% endif %}>
                  </td>
                </tr>
              {% endif %}

            {% endfor %}
          </tbody>
        </table>

        <!-- ================= –ù–ò–ñ–ù–ò–ô –ë–õ–û–ö (3 –ö–û–õ–û–ù–ö–ò) ================= -->
        <table class="t2" style="margin-top:10px;min-width:980px;">
          <colgroup>
            <col>
            <col style="width:140px;">
            <col style="width:140px;">
          </colgroup>

          <thead>
            <tr><th colspan="3" class="secTitle"></th></tr>
          </thead>

          <tbody>
            <tr>
              <td class="bold">–í—ã–≥—Ä—É–∂–µ–Ω–æ –≤–∞–≥.</td>
              <td class="center">
                <input name="{{ bottom.vygr_wag_ktk }}" value="{{ obj|data_val:bottom.vygr_wag_ktk }}" {% if mode == 'view' %}disabled{% endif %}>
              </td>
              <td class="center">
                <input name="{{ bottom.vygr_tonn }}" value="{{ obj|data_val:bottom.vygr_tonn }}" {% if mode == 'view' %}disabled{% endif %}>
              </td>
            </tr>

            <tr>
              <td class="bold">–ü–æ–≥—Ä—É–∂–µ–Ω–æ –≤–∞–≥.</td>
              <td class="center">
                <input name="{{ bottom.pogr_wag_ktk }}" value="{{ obj|data_val:bottom.pogr_wag_ktk }}" {% if mode == 'view' %}disabled{% endif %}>
              </td>
              <td class="center">
                <input name="{{ bottom.pogr_tonn }}" value="{{ obj|data_val:bottom.pogr_tonn }}" {% if mode == 'view' %}disabled{% endif %}>
              </td>
            </tr>

            <tr>
              <td class="danger">–ì—Ä—É–∑ –Ω–∞ —Å–≤–æ–∏—Ö –æ—Å—è—Ö (–≤–∞–≥)</td>
              <td class="center">
                <input name="{{ bottom.os_wag_ktk }}" value="{{ obj|data_val:bottom.os_wag_ktk }}" {% if mode == 'view' %}disabled{% endif %}>
              </td>
              <td class="center">
                <input name="{{ bottom.os_tonn }}" value="{{ obj|data_val:bottom.os_tonn }}" {% if mode == 'view' %}disabled{% endif %}>
              </td>
            </tr>

            <tr>
              <td rowspan="2" class="bold">–ü–û–ì–†–£–ñ–ï–ù–û (–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞)</td>
              <td rowspan="2" class="center bold">–û–±—ä—ë–º</td>
              <td class="center">
                <input name="{{ bottom.cargo_name }}" value="{{ obj|data_val:bottom.cargo_name }}" {% if mode == 'view' %}disabled{% endif %}>
              </td>
            </tr>
            <tr>
              <td class="center">
                <input name="{{ bottom.cargo_volume }}" value="{{ obj|data_val:bottom.cargo_volume }}" {% if mode == 'view' %}disabled{% endif %}>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- ================= –ö–ü –ü–û –°–ï–ö–¢–û–†–£ ================= -->
        <table class="t2" style="margin-top:10px;min-width:980px;">
          <colgroup>
            <col style="width:140px;">
            <col>
            <col>
            <col>
          </colgroup>

          <thead>
            <tr>
              <th colspan="4" class="secTitle">–ù–∞–ª–∏—á–∏–µ –Ω–∞ –ö–ü –ø–æ —Å–µ–∫—Ç–æ—Ä—É</th>
            </tr>
            <tr>
              <th></th>
              <th class="center bold">–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å</th>
              <th class="center bold">–§–∞–∫—Ç</th>
              <th class="center bold">–°–≤–æ–±–æ–¥–Ω–æ</th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td class="center bold">–§–ü</td>
              <td class="center"><input name="{{ bottom.kp_fp_capacity }}" value="{{ obj|data_val:bottom.kp_fp_capacity }}" {% if mode == 'view' %}disabled{% endif %}></td>
              <td class="center"><input name="{{ bottom.kp_fp_fact }}" value="{{ obj|data_val:bottom.kp_fp_fact }}" {% if mode == 'view' %}disabled{% endif %}></td>
              <td class="center"><input name="{{ bottom.kp_fp_free }}" value="{{ obj|data_val:bottom.kp_fp_free }}" {% if mode == 'view' %}disabled{% endif %}></td>
            </tr>

            <tr>
              <td class="center bold">–£–£–°</td>
              <td class="center"><input name="{{ bottom.kp_uus_capacity }}" value="{{ obj|data_val:bottom.kp_uus_capacity }}" {% if mode == 'view' %}disabled{% endif %}></td>
              <td class="center"><input name="{{ bottom.kp_uus_fact }}" value="{{ obj|data_val:bottom.kp_uus_fact }}" {% if mode == 'view' %}disabled{% endif %}></td>
              <td class="center"><input name="{{ bottom.kp_uus_free }}" value="{{ obj|data_val:bottom.kp_uus_free }}" {% if mode == 'view' %}disabled{% endif %}></td>
            </tr>

            <tr>
              <td>–ì–æ—Ç–æ–≤—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ</td>
              <td class="center"><input name="{{ bottom.kp_ready_send_capacity }}" value="{{ obj|data_val:bottom.kp_ready_send_capacity }}" {% if mode == 'view' %}disabled{% endif %}></td>
              <td class="center"><input name="{{ bottom.kp_ready_send_fact }}" value="{{ obj|data_val:bottom.kp_ready_send_fact }}" {% if mode == 'view' %}disabled{% endif %}></td>
              <td class="center"><input name="{{ bottom.kp_ready_send_free }}" value="{{ obj|data_val:bottom.kp_ready_send_free }}" {% if mode == 'view' %}disabled{% endif %}></td>
            </tr>

            <tr>
              <td>–ì–æ—Ç–æ–≤—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫ –≤—ã–≤–æ–∑—É</td>
              <td class="center"><input name="{{ bottom.kp_ready_autocar_capacity }}" value="{{ obj|data_val:bottom.kp_ready_autocar_capacity }}" {% if mode == 'view' %}disabled{% endif %}></td>
              <td class="center"><input name="{{ bottom.kp_ready_autocar_fact }}" value="{{ obj|data_val:bottom.kp_ready_autocar_fact }}" {% if mode == 'view' %}disabled{% endif %}></td>
              <td class="center"><input name="{{ bottom.kp_ready_autocar_free }}" value="{{ obj|data_val:bottom.kp_ready_autocar_free }}" {% if mode == 'view' %}disabled{% endif %}></td>
            </tr>
          </tbody>
        </table>

      </div>

      

      {% if error %}
        <div style="background:#fee2e2;border:1px solid #fecaca;color:#991b1b;padding:10px 12px;border-radius:12px;font-weight:900;margin:12px 0 0;">
          {{ error }}
        </div>
      {% endif %}

    </form>
  </div>
</div>
{% endblock %}
