{% extends "base.html" %}
{% load report_extras %}

{% block title %}Админ — Таблица 1 за {{ date|date:"d.m.Y" }}{% endblock %}

{% block content %}
<style>
  /* ====== Page shell ====== */
  .panel{
    background: var(--surface);
    border: 1px solid var(--stroke);
    border-radius: 20px;
    box-shadow: var(--shadow);
    padding: 14px;
    backdrop-filter: blur(14px);
  }

  .topbarx{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:12px;
    flex-wrap:wrap;
    margin-bottom:12px;
  }

  .titlebox h2{
    margin:0;
    font-size:20px;
    font-weight:950;
    letter-spacing:-.02em;
    color:var(--text);
  }
  .subtitle{
    margin-top:6px;
    color:var(--muted);
    font-size:13px;
    line-height:1.4;
  }

  /* ====== Back button ====== */
  .btnBack{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding:10px 14px;
    border-radius:999px;
    border:1px solid var(--stroke);
    background:rgba(255,255,255,.55);
    color:var(--text);
    text-decoration:none;
    font-weight:900;
    white-space:nowrap;
    box-shadow: 0 14px 34px rgba(15,23,42,.08);
    transition:transform .14s ease, box-shadow .14s ease, filter .14s ease;
  }
  html[data-theme="dark"] .btnBack{ background:rgba(255,255,255,.06); }
  .btnBack:hover{
    transform:translateY(-1px);
    box-shadow: 0 18px 48px rgba(15,23,42,.12);
    filter:brightness(1.02);
  }
  .btnBack .ic{
    width:28px;height:28px;border-radius:999px;
    display:flex;align-items:center;justify-content:center;
    border:1px solid var(--stroke);
    background:rgba(255,255,255,.55);
  }
  html[data-theme="dark"] .btnBack .ic{ background:rgba(255,255,255,.06); }

  /* ====== Scroll wrapper ====== */
  .xwrap{
    border:1px solid var(--stroke);
    border-radius:18px;
    overflow:auto;
    background:rgba(255,255,255,.20);
    -webkit-overflow-scrolling: touch;
  }
  html[data-theme="dark"] .xwrap{ background:rgba(255,255,255,.04); }

  .xhdr{
    min-width:1400px;
    padding:12px 14px;
    text-align:center;
    font-weight:950;
    border-bottom:1px solid var(--stroke);
    background:rgba(255,255,255,.35);
    color:var(--text);
  }
  html[data-theme="dark"] .xhdr{ background:rgba(255,255,255,.06); }

  /* ====== Strong grid lines (better visible) ====== */
  :root{
    --grid: rgba(15,23,42,.22);
    --sticky-shadow: rgba(15,23,42,.12);
  }
  html[data-theme="dark"]{
    --grid: rgba(255,255,255,.22);
    --sticky-shadow: rgba(0,0,0,.45);
  }

  /* ====== Table ====== */
  table.xtable{
    border-collapse: separate;
    border-spacing: 0;
    min-width:2200px;
    width:max-content;
    table-layout:fixed;
  }
  .xtable th,.xtable td{
    border-right:1px solid var(--grid);
    border-bottom:1px solid var(--grid);
    padding:6px 8px;
    font-size:12px;
    text-align:center;
    vertical-align:middle;
    color:var(--text);
    background:transparent;
  }
  /* outer border look */
  .xtable thead tr:first-child th{ border-top:1px solid var(--grid); }
  .xtable tr > *:first-child{ border-left:1px solid var(--grid); }

  /* header sticky */
  .xtable thead th{
    position:sticky;
    top:0;
    z-index:20;
    background: var(--surface);
    font-weight:950;
  }

  /* vertical header text */
  .vtxt{
    writing-mode:vertical-rl;
    transform:rotate(180deg);
    white-space:nowrap;
    font-weight:900;
    line-height:1.05;
  }

  /* column widths (IMPORTANT for sticky offsets) */
  :root{
    --col-lc: 190px;
    --col-shift: 70px;
  }
  .lcname{
    width:var(--col-lc);
    min-width:var(--col-lc);
    max-width:var(--col-lc);
    font-weight:950;
    text-align:left;
    padding-left:10px;
  }
  .shift{
    width:var(--col-shift);
    min-width:var(--col-shift);
    max-width:var(--col-shift);
    font-weight:950;
    background:rgba(248,250,252,.85);
  }
  html[data-theme="dark"] .shift{ background:rgba(255,255,255,.04); }

  /* sticky first 2 cols: FIX overlap */
  .stickyA{
    position:sticky;
    left:0;
    z-index:30;
    background: var(--surface);
    box-shadow: 10px 0 16px -14px var(--sticky-shadow);
  }
  .stickyB{
    position:sticky;
    left:var(--col-lc);
    z-index:29;
    background: var(--surface);
    box-shadow: 10px 0 16px -14px var(--sticky-shadow);
  }
  .xtable thead .stickyA{ z-index:60; }
  .xtable thead .stickyB{ z-index:59; }

  /* total row */
  .g-total td{
    background: rgba(255,244,204,.65);
    font-weight:950;
  }
  html[data-theme="dark"] .g-total td{
    background: rgba(255,244,204,.12);
  }

  /* row hover */
  .xtable tbody tr:hover td{ background: rgba(79,70,229,.06); }
  html[data-theme="dark"] .xtable tbody tr:hover td{ background: rgba(99,102,241,.10); }

  .note{
    margin-top:10px;
    color:var(--muted);
    font-size:13px;
    line-height:1.45;
  }

  /* ====== Responsive ====== */
  @media (max-width: 980px){
    .titlebox h2{ font-size:18px; }
    .xhdr{ font-size:13px; }
    :root{ --col-lc: 160px; --col-shift: 64px; }
    .xtable th,.xtable td{ padding:6px 6px; font-size:11.5px; }
  }
  @media (max-width: 520px){
    .btnBack{ width:100%; justify-content:center; }
  }
</style>

<div class="panel">
  <div class="topbarx">
    <div class="titlebox">
      <h2>
        <span data-i18n="t1_admin_title">Hisobot №1</span> — {{ date|date:"d.m.Y" }}
      </h2>
      <div class="subtitle" data-i18n="t1_admin_sub">
        Logistika markazlari bo‘yicha operativ ma’lumot (admin ko‘rish).
      </div>
    </div>

    <a class="btnBack" href="{% url 'admin_table1_reports' %}">
      <span class="ic" aria-hidden="true">←</span>
      <span data-i18n="back_to_list">Ro‘yxatga qaytish</span>
    </a>
  </div>

  <div class="xwrap">
    <div class="xhdr" data-i18n="t1_admin_header">
      Оперативная информация о работе логистических центров АО "Узтемирйулконтейнер" в сутки —
      {{ date|date:"d.m.Y" }} — к 18:00 час
    </div>

    <table class="xtable">
      <thead>
        <tr>
          <th rowspan="2" class="lcname stickyA" data-i18n="col_lc">Наименование ЛЦ</th>
          <th rowspan="2" class="shift stickyB" data-i18n="col_shift">Смена</th>

          {% for key,label in fields %}
            <th rowspan="2">
              <div class="vtxt">{{ label }}</div>
            </th>
          {% endfor %}
        </tr>
        <tr></tr>
      </thead>

      <tbody>
        {% for st in stations %}

          <!-- DAY -->
          <tr>
            <td rowspan="3" class="lcname stickyA">{{ st.name }}</td>
            <td class="shift stickyB" data-i18n="shift_day">день</td>
            {% for key,label in fields %}
              <td>{{ st.day_data|get_item:key|default_if_none:"0" }}</td>
            {% endfor %}
          </tr>

          <!-- NIGHT -->
          <tr>
            <td class="shift stickyB" data-i18n="shift_night">ночь</td>
            {% for key,label in fields %}
              <td>{{ st.night_data|get_item:key|default_if_none:"0" }}</td>
            {% endfor %}
          </tr>

          <!-- TOTAL -->
          <tr class="g-total">
            <td class="shift stickyB" data-i18n="shift_total">итог</td>
            {% for key,label in fields %}
              <td><b>{{ st.total_data|get_item:key|default_if_none:"0" }}</b></td>
            {% endfor %}
          </tr>

        {% empty %}
          <tr>
            <td colspan="999" data-i18n="no_data">Нет данных по этой дате</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="note">
    <span data-i18n="t1_admin_note">
      Izoh: admin panelda “jami” maydonlari “ft+kr+pv+prochee” bo‘yicha hisoblanadi, “jami kon” esa “kont.” ni takrorlaydi
      (bloklar: Tushirish / Tushirishda / Yuklash / Yuklashda).
    </span>
  </div>
</div>
<script>
(function(){
  // ===== Page i18n (UZ/RU) =====
  const dict = {
    uz: {
      t1_admin_title: "Hisobot №1 —",
      t1_admin_sub: "Logistika markazlari bo‘yicha operativ ma’lumot (admin ko‘rish).",
      back_list: "Ro‘yxatga qaytish",
      t1_header_1: "“O‘ztemiryo‘lkonteyner” AJ logistika markazlari ish faoliyati bo‘yicha operativ ma’lumot",
      t1_header_2: "sutka kesimida —",
      t1_header_3: "— soat 18:00 ga",
      col_lc: "LМ nomi",
      col_shift: "Smena",
      shift_day: "kun",
      shift_night: "tun",
      shift_total: "jami",
      empty: "Ushbu sana bo‘yicha ma’lumot yo‘q",
      note: "Izoh: admin panelda “jami” maydonlari “ft+kr+pv+прочее” bo‘yicha hisoblanadi, “jami kon” esa “kont.” ni takrorlaydi (bloklar: Tushirish / Tushirishda / Yuklash / Yuklashda)."
    },
    ru: {
      t1_admin_title: "Таблица №1 —",
      t1_admin_sub: "Оперативная информация по логистическим центрам (админ просмотр).",
      back_list: "Назад к списку",
      t1_header_1: "Оперативная информация о работе логистических центров АО",
      t1_header_2: "в сутки —",
      t1_header_3: "— к 18:00 час",
      col_lc: "Наименование ЛЦ",
      col_shift: "Смена",
      shift_day: "день",
      shift_night: "ночь",
      shift_total: "итог",
      empty: "Нет данных по этой дате",
      note: "Примечание: в админке поля “итого” считаются как “фт+кр+пв+прочее”, а “итого кон” зеркалит “конт.” (для блоков: Выгрузка / Под выгрузкой / Погрузка / Под погрузкой)."
    }
  };

  function getLang(){
    const htmlLang = document.documentElement.getAttribute("data-lang");
    const ls = localStorage.getItem("lang") || localStorage.getItem("ui_lang");
    const lang = (htmlLang || ls || "uz").toLowerCase();
    return (lang === "ru") ? "ru" : "uz";
  }

  function applyLang(lang){
    const t = dict[lang] || dict.uz;
    document.querySelectorAll("[data-i18n]").forEach(el=>{
      const k = el.getAttribute("data-i18n");
      if (t[k] !== undefined) el.textContent = t[k];
    });
  }

  // initial
  applyLang(getLang());

  // react to base toggle:
  window.addEventListener("storage", (e)=>{
    if (e.key === "lang" || e.key === "ui_lang") applyLang(getLang());
  });

  // if base changes html[data-lang]
  const mo = new MutationObserver(()=>{
    applyLang(getLang());
  });
  mo.observe(document.documentElement, { attributes:true, attributeFilter:["data-lang"] });
})();
</script>
{% endblock %}
