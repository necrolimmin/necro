{% extends "base.html" %}
{% load report_extras %}

{% block title %}Terminal kesimida — {{ station_name }} — блоки (Таблица 1){% endblock %}

{% block content %}
<style>
  .panel{
    /* background: var(--surface); */
    border:1px solid var(--stroke);
    border-radius: 20px;
    box-shadow: var(--shadow);
    padding: 14px;
  }
  .head{
    display:flex;
    align-items:flex-end;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
    margin-bottom: 12px;
  }
  .title{
    margin:0;
    font-weight: 950;
    color: var(--text);
    letter-spacing:-.01em;
  }
  .muted{ margin:6px 0 0; color: var(--muted); font-size: 13px; }
  .btn{
    display:inline-flex;
    align-items:center;
    gap:8px;
    height: 42px;
    padding: 0 14px;
    border-radius: 14px;
    border: 1px solid var(--stroke);
    text-decoration:none;
    font-weight: 900;
    color: var(--text);
    background: rgba(255,255,255,.55);
  }
  html[data-theme="dark"] .btn{ background: rgba(255,255,255,.06); }

  .grid{
    display:grid;
    grid-template-columns: 1fr;
    gap: 14px;
  }
  .block{
    border:1px solid var(--stroke);
    border-radius: 18px;
    overflow:hidden;
    background: rgba(255,255,255,.18);
  }
  html[data-theme="dark"] .block{ background: rgba(255,255,255,.04); }

  .block-h{
    padding: 10px 12px;
    font-weight: 950;
    border-bottom: 1px solid var(--stroke);
    background: rgba(255,255,255,.35);
    color: var(--text);
  }
  html[data-theme="dark"] .block-h{ background: rgba(255,255,255,.06); }

  .sc{
    overflow:auto;
    -webkit-overflow-scrolling: touch;
  }

  table{
    border-collapse: collapse;
    width: 100%;
    min-width: 1400px;
  }
  th, td{
    border:1px solid rgba(15,23,42,.16);
    padding: 6px 6px;
    text-align:center;
    font-size: 12px;
    color: var(--text);
    background: transparent;
  }
  html[data-theme="dark"] th, html[data-theme="dark"] td{
    border:1px solid rgba(255,255,255,.16);
  }

  th{
    font-weight: 950;
    background: rgba(255,255,255,.22);
    position: sticky;
    top: 0;
    z-index: 2;
  }
  html[data-theme="dark"] th{ background: rgba(255,255,255,.06); }

  .rowname{
    text-align:left;
    font-weight: 950;
    position: sticky;
    left: 0;
    z-index: 3;
    background: var(--surface);
  }
  .shift{
    font-weight: 950;
    width: 90px;
    white-space: nowrap;
  }

  td{
    font-variant-numeric: tabular-nums;
  }

</style>

<div class="panel">
  <div class="head">
    <div>
      <h3 class="title">{{ station_name }}  —  Jadval №1 Terminallar kesimida — {{ date|date:"d.m.Y" }} </h3>
      <p class="muted">Terminallarning ish ko'rsatkichlari</p>
    </div>

    <a class="btn" href="{% url 'admin_table1_report_view' date|date:'Y-m-d' %}">
      ← ortga
    </a>
  </div>

  <div class="grid">
    {% for blk in blocks_ctx %}
      <div class="block">
        <div class="block-h">Terminal {{ blk.b }}</div>
        <div class="sc">
          <table>
            <thead>
              <tr>
                <th class="rowname">Смена</th>
                {% for k, label in fields %}
                  <th>{{ label }}</th>
                {% endfor %}
              </tr>
            </thead>

            <tbody>
              <tr>
                <td class="rowname shift">День</td>
                {% for k, label in fields %}
                  <td>{{ blk.day_obj|data_val:k }}</td>
                {% endfor %}
              </tr>

              <tr>
                <td class="rowname shift">Ночь</td>
                {% for k, label in fields %}
                  <td>{{ blk.night_obj|data_val:k }}</td>
                {% endfor %}
              </tr>

              <tr>
                <td class="rowname shift">Итог</td>
                {% for k, label in fields %}
                  <td style="font-weight: 700;">{{ blk.total_obj|data_val:k }}</td>
                {% endfor %}
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    {% endfor %}
  </div>

</div>

  <script>
   (function(){
      // 1 234 567 ko'rinish (space / nbsp bilan chiqadi)
      const fmt = new Intl.NumberFormat('ru-RU');

      // Bu sahifadagi barcha jadvallar
      document.querySelectorAll('.grid table tbody td').forEach(td => {
        // Chapdagi sticky rowname/shift ustunini tegmaymiz
        if (td.classList.contains('rowname') || td.classList.contains('shift')) return;

        let s = (td.textContent || '').trim();

        // Faqat butun sonlarni formatlaymiz
        // (agar sizda -123 bo'lsa ham ishlaydi)
        if (!/^-?\d+$/.test(s)) return;

        const n = Number(s);
        if (!Number.isFinite(n)) return;

        td.textContent = fmt.format(n);
      });
    })();
  </script>

{% endblock %}
